environment:
  host:
    os: 'windows'
    flavor: 'server'
    version: '2016'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxwin.azurecr.io/user/powertoys/vs2019:3.0'
    source_mode: 'link'

version:
  name: 'PowerToys'
  major: 1
  minor: 0

signing_options:
  profile: 'external_distribution'

package_sources:
  nuget:
    feeds:
      'Nuget': 'https://api.nuget.org/v3/index.json'

restore:
  commands:
    - !!defaultcommand
      name: 'Restore Power Toys'
      command: '.pipelines\restore.cmd'
    - !!defaultcommand
      name: 'Restore Installer'
      command: '.pipelines\restore-installer.cmd'

build:
  commands:
    - !!buildcommand
      name: 'Build Power Toys'
      command: '.pipelines\build.cmd'
      artifacts:
        - from: 'x64/Release'
          to: 'Build_Output'
          include:
          - 'PowerToys.exe'
          - 'PowerToysSettings.exe'
          - 'modules\FancyZonesEditor.exe'
          - 'modules\fancyzones.dll'
          - 'modules\shortcut_guide.dll'
          signing_options:
            sign_inline: true  # This does signing a soon as this command completes

    - !!buildcommand
      name: 'Build Power Toys Installer'
      command: '.pipelines\build-installer.cmd'
      artifacts:
        - from: 'installer\PowerToysSetup\x64\Release'
          to: 'Build_Installer_Output'
          include:
            - '*.zip'
          signing_options:
            sign_inline: true  # This does signing a soon as this command completes